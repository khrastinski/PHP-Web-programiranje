<?php
define('__APP__', TRUE);
session_start();

$menu = isset($_GET['menu']) ? (int)$_GET['menu'] : 1;
$action = isset($_GET['action']) ? (int)$_GET['action'] : 0;
?>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>PHP Session</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="<?= ($menu > 1) ? 'hero-subimage' : 'hero-image' ?>"></div>
    <nav><?php include "menu.php"; ?></nav>
</header>

<main class="<?= isset($_SESSION['last']) ? 'session' : '' ?>">
<?php
if ($menu == 1) include "home.php";
if ($menu == 2) include "news.php";
if ($menu == 3) include "contact.php";
if ($menu == 4) include "about-us.php";
?>
</main>

<?php if (isset($_SESSION['last'])): ?>
<aside>
    <h2>ZADNJE PREGLEDANO</h2>
    <?php foreach ($_SESSION['last'] as $l): ?>
        <p><a href="<?= $l['link'] ?>"><?= $l['title'] ?></a></p>
    <?php endforeach; ?>
</aside>
<?php endif; ?>

<footer>
    <p>Â© <?= date("Y") ?> Karlo Hrastinski</p>
</footer>

</body>
</html>


<?php
if (!isset($_SESSION['last'])) $_SESSION['last'] = [];

function remember($id, $title) {
    $_SESSION['last'] = array_filter($_SESSION['last'], fn($n) => $n['id'] != $id);
    array_unshift($_SESSION['last'], ['id'=>$id,'title'=>$title,'link'=>"index.php?menu=2&action=$id"]);
    $_SESSION['last'] = array_slice($_SESSION['last'], 0, 3);
}

if (!isset($action)) {
?>
<h1>NEWS</h1>

<h2><a href="index.php?menu=2&action=1">US growth faster than expected</a></h2>
<hr>
<h2><a href="index.php?menu=2&action=2">Wall Street: Tech firm surge</a></h2>
<hr>
<h2><a href="index.php?menu=2&action=3">Hotel booking sites probed</a></h2>
<?php
} else {

if ($action == 1) { remember(1,"US growth faster than expected"); echo "<h2>US growth faster than expected</h2>"; }
if ($action == 2) { remember(2,"Wall Street: Tech firm surge"); echo "<h2>Wall Street: Tech firm surge</h2>"; }
if ($action == 3) { remember(3,"Hotel booking sites probed"); echo "<h2>Hotel booking sites probed</h2>"; }

echo '<p><a href="index.php?menu=2">Back</a></p>';
}
?>
